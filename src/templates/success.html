<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Authentication Successful</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 16px;
        padding: 3rem 2rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
        max-width: 600px;
        width: 100%;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #28a745, #20c997);
      }

      .icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        display: block;
        width: 128px;
        height: 128px;
        animation: bounceIn 0.6s ease-out;
      }

      .title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 1rem;
      }

      .message {
        color: #718096;
        font-size: 1rem;
        line-height: 1.5;
        margin-bottom: 1.5rem;
      }

      .token-section {
        margin-top: 1.5rem;
        width: 100%;
      }

      .token-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: #4a5568;
        margin-bottom: 0.5rem;
        display: block;
        text-align: left;
      }

      .token-container {
        border: 1px solid #e9ecef;
        border-radius: 8px;
        margin-bottom: 0.75rem;
        overflow: hidden;
      }

      .token-header {
        background: #f1f3f4;
        border-bottom: 1px solid #e9ecef;
        padding: 0.5rem 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.875rem;
        font-weight: 500;
        color: #495057;
      }

      .token-display {
        font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        font-size: 0.75rem;
        word-break: break-all;
        background: #f8f9fa;
        color: #495057;
        padding: .2rem;
        border: none;
        max-height: 150px;
        overflow-y: auto;
        line-height: 1.4;
        margin: 0;
      }

      .copy-button {
        background: #6c757d;
        color: white;
        border: none;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
      }

      .copy-button:hover {
        background: #5a6268;
        transform: translateY(-1px);
      }

      .copy-button:active {
        transform: translateY(0);
      }

      .copy-button.copied {
        background: #38a169;
      }

      .copy-icon {
        width: 14px;
        height: 14px;
      }

      .hidden {
        display: none !important;
      }

      @keyframes bounceIn {
        0% {
          transform: scale(0.3);
          opacity: 0;
        }
        50% {
          transform: scale(1.05);
        }
        70% {
          transform: scale(0.9);
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: 2rem 1.5rem;
        }
        .title {
          font-size: 1.25rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <span class="icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
          <path
            fill="#28a745"
            d="M320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576zM404.4 276.7L324.4 404.7C320.2 411.4 313 415.6 305.1 416C297.2 416.4 289.6 412.8 284.9 406.4L236.9 342.4C228.9 331.8 231.1 316.8 241.7 308.8C252.3 300.8 267.3 303 275.3 313.6L302.3 349.6L363.7 251.3C370.7 240.1 385.5 236.6 396.8 243.7C408.1 250.8 411.5 265.5 404.4 276.8z"
          />
        </svg>
      </span>
      <h1 class="title">Authentication Successful!</h1>
      <p class="message">
        You can now close this browser window and return to the terminal.
      </p>
      
      <div class="token-section" id="tokenSection">
        <div class="token-container">
          <div class="token-header">
            <span>Access Token</span>
            <button class="copy-button" id="copyButton" onclick="copyToken()">
              <svg class="copy-icon" fill="currentColor" viewBox="0 0 20 20">
                <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path>
                <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"></path>
              </svg>
              <span id="copyText">Copy</span>
            </button>
          </div>
          <div class="token-display" id="tokenDisplay">{access_token}</div>
        </div>
      </div>
    </div>
    
    <script>
      const tokenSection = document.getElementById('tokenSection');
      const tokenDisplay = document.getElementById('tokenDisplay');
      let currentToken = '{access_token}';
      
      if (!currentToken || currentToken === '{access_token}') {
        tokenSection.style.display = 'none';
        pollForToken();
      } else {
        tokenSection.style.display = 'block';
      }
      
      async function pollForToken() {
        let attempts = 0;
        const maxAttempts = 30;
        
        const poll = async () => {
          if (attempts >= maxAttempts) {
            return;
          }
          
          try {
            const response = await fetch('/token');
            if (response.ok) {
              const data = await response.json();
              if (data.token) {
                currentToken = data.token;
                tokenDisplay.textContent = currentToken;
                tokenSection.style.display = 'block';
                return;
              }
            }
          } catch (error) {
            console.log('Polling for token...', error);
          }
          
          attempts++;
          setTimeout(poll, 500);
        };
        
        poll();
      }
      
      async function copyToken() {
        const copyButton = document.getElementById('copyButton');
        const copyText = document.getElementById('copyText');
        const token = currentToken;
        
        try {
          if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(token);
          } else {
            const textArea = document.createElement('textarea');
            textArea.value = token;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
          }
          
          copyButton.classList.add('copied');
          copyText.textContent = 'Copied!';
          
          setTimeout(() => {
            copyButton.classList.remove('copied');
            copyText.textContent = 'Copy';
          }, 2000);
          
        } catch (err) {
          console.error('Failed to copy token:', err);
          copyText.textContent = 'Copy failed';
          setTimeout(() => {
            copyText.textContent = 'Copy Token';
          }, 2000);
        }
      }
    </script>
  </body>
</html>
